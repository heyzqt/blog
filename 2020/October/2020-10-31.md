# 知识点整理

## puppeteer 在使用时报错

puppeteer 是一个 Node 库，可以使用 DevTools 协议控制 chrome，让 chrome 浏览器在 headless 模式下运行。

headless：Chrome 浏览器的无头模式，正常访问网页是通过浏览器访问，headless 可以理解在没有图形化界面的情况下，比如在控制台访问浏览器。

puppeteer 能提供的功能：

- 生成页面 PDF
- 抓取 SPA(单页面应用) 并生成 SSR 内容
- 自动提交表单，进行 UI 测试、键盘输入等
- 创建一个实时更新的自动化测试环境，使用最新的 JavaScript 和最新的 Chrome 在中执行测试
- 捕获浏览器的 timeliness trace，用来帮助分析性能问题
- 测试浏览器扩展

### 安装 puppeteer

todo 使用 node v6.4.0，使用命令`npm i puppeteer`安装 puppeteer 库，同时还会下载最新版本的 Chromeium 在`/node_modules/puppeteer/.local-chromium/mac-809590/chrome-mac/`目录下

### 运行一个简单的 demo

```javascript
//对当前网页截图并生成PDF
const puppeteer = require("puppeteer");

(async () => {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.goto("https://www.baidu.com/");
  await page.screenshot({ path: "example.png" });

  //在page.evaluate的回调函数中访问浏览器对象，可以进行dom操作
  await page.evaluate(() => {
    console.log("evaluate");
  });

  await browser.close();
})();
```

### 使用中遇到的报错

- 报错 1：报错`UnhandledPromiseRejectionWarning (找不到浏览器xxxxx)`，这个报错意思是没有找到 puppeteer 安装的 chrome 浏览器，下载 puppeteer 时安装浏览器失败。可以看看有没有`node_modules/puppeteer/.local-chromium/`目录，如果没有的话，就知道 chrome 浏览器没有安装成功，需要重新下载 puppeteer

- 报错 2：运行项目时一些奇奇怪怪的报错，大概率是安装 puppeteer 的 Node 版本不正确导致，报错 1 安装 chrome 浏览器时也要注意 node 的版本最好和下载 puppeteer 的版本一致

- 安装 puppeteer 的 node 版本选择，puppeteer支持的最低版本是6.4.0，最好选用Node v7.6.0及以上版本安装，这样可以支持async/await，不能使用Node v14.0.0版本，会导致在下载puppeteer中的chrome时，会导致解压浏览器失败，不能使用，其他的node版本修复了这个问题
